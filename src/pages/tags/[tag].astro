---
import { getCollection } from "astro:content";
import PostPreview from "../../components/PostPreview.astro";

/* The getStaticPaths function returns an array of page routes, and all of the pages at those routes will use the same template defined in the file. */
export async function getStaticPaths() {
  const tags = ["astro", "javascript", "typescript"].map((tag) => ({
    params: { tag },
  }));

  const postsWithSlugs = await getCollection("blog");
  /* Create a page for each tag, passing in the tag as a parameter.
  Pass in the tag as a parameter (which will replace [tag] in the file) 
  and pass in the matching posts as props */
  return tags.map((value) => ({
    ...value,
    params: {
      tag: value.params.tag,
    },
    props: {
      posts: postsWithSlugs.filter((post) =>
        post.data.tags?.includes(value.params.tag)
      ),
    },
  }));
}

const { tag } = Astro.params;
const { posts } = Astro.props;
---

<ul>
  {
    posts.map((post: any) => (
      <>
        <PostPreview post={post} featured={true} />
      </>
    ))
  }
</ul>
<p>Posts tagged with {tag}</p>
